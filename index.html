<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Supabase 认证测试</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Supabase 登录注册演示</h1>

    <div id="auth-form">
        <input type="email" id="email" placeholder="邮箱地址"><br><br>
        <input type="password" id="password" placeholder="密码"><br><br>
        <button onclick="handleSignUp()">注册</button>
        <button onclick="handleSignIn()">登录</button>
    </div>

    <div id="user-info" style="display: none;">
        <p>欢迎回来，<span id="user-email"></span>!</p>
        <button onclick="handleSignOut()">退出登录</button>
    </div>

    <script>
        // 1. 初始化 Supabase 客户端
        // 请替换为您在第一步中获取的实际 URL 和 KEY
        const SUPABASE_URL = 'https://cpapbseovbithrnavygb.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_T5oWIPZi1MZZu9XeIWaheQ_e98Tc2DE';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // 2. 注册功能
        async function handleSignUp() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const { data, error } = await supabase.auth.signUp({ email, password });
            
            if (error) alert("注册失败: " + error.message);
            else alert("注册成功！请查收邮件确认激活（如果开启了邮箱验证）。");
        }

        // 3. 登录功能
        async function handleSignIn() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) alert("登录失败: " + error.message);
            else console.log("登录成功:", data);
        }

        // 4. 退出登录
        async function handleSignOut() {
            await supabase.auth.signOut();
            alert("已退出");
        }

        // 5. 监听登录状态变化 (核心逻辑)
        supabase.auth.onAuthStateChange((event, session) => {
            const authForm = document.getElementById('auth-form');
            const userInfo = document.getElementById('user-info');
            const userEmail = document.getElementById('user-email');

            if (session) {
                // 用户已登录
                authForm.style.display = 'none';
                userInfo.style.display = 'block';
                userEmail.innerText = session.user.email;
            } else {
                // 用户未登录
                authForm.style.display = 'block';
                userInfo.style.display = 'none';
            }
        });
    </script>
</body>
</html>